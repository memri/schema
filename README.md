## About
Schema is an open-source component of [Memri](https://blog.memri.io). It functions as the single source of truth of the
data model of your personal data. The latest stable version can be explored at 
[schema.memri.io](https://schema.memri.io).  

This repository contains code to export schema definitions for both the 
[Pod](https://gitlab.memri.io/memri/pod) and the [iOS app](https://gitlab.memri.io/memri/ios-application). This is only
necessary if you [change the schema](#Changing the schema), as they both repositories already include a generated 
schema.

## Local build/install
To run the code, make sure you have [Node.js and npm](https://www.npmjs.com/get-npm) installed and run:
```bash
cd tools/
npm install
```

To run the explorer (web app): `node explorer.js`  
To test whether the schema contains inconsistencies: `node test.js`  
To export the schema for the pod: `node export_schema_pod.js`  
To export the schema for the ios application: `node export_schema_ios_application.js`  

## The schema
The schema consists of 3 parts:
* Item Hierarchy
* Edge & Property Hierarchy
* Primitive Types

### Item Hierarchy
All the data points in Memri are called items, e.g. a Person, a Location or a Video. The top level item is called Item, 
and all other items inherit all the properties and edges of Item.

The Item hierarchy defines:
* What types of Items exist
* What properties and edges an Item can have
* How Items are positioned in the hierarchy

### Edge & Property Hierarchy
Items can have Edges and Properties, which are in the same hierarchy.

The Edge & Property hierarchy defines:
* What types of Edges and Properties exist
* What types Edges and Properties expect.
* How Edges and Properties are positioned in the hierarchy

#### Edges
Edges are connections to other items, for instance, there might be a 'father' edge between two Persons. By default, 
edges are one-to-many relations: An item can have any number of edges of an allowed edge type.

#### Properties
Where edges connect to other items, properties connect directly to a value of a primitive type, for instance, an item 
could have a 'name' property of type 'String'. Properties are always one-to-one relations: An item can only have single 
value for a property.

### Primitive types
The primitive types that are supported by the data model. All properties must have one of these types.

## Changing the schema
The schema is stored as two directory trees for the two hierarchies, with a set of files to define their
characteristics. 

The information of an Item is stored as follows:
* The directory location defines it's position in the hierarchy
* The directory name is the name of the Item type
* `description.md` contains the description of the Item
* `*Color.txt` defines the display of the colors
* `properties` defines the properties and edges the Item can have

The information of an  is stored as follows:

If you added an Item, Edge or Property, make sure to run `node test.js` to see whether there are inconsistencies. If 
there aren't, `node export_schema_pod.js` creates a file for the Pod located at `pod/res/autogenerated_schema.json`; 
`node export_schema_ios_application.js` creates a file for the iOS application located at 
`ios-application/memri/model/schema.swift`. Lastly, rebuild both the Pod and iOS application and you have an updated 
schema.